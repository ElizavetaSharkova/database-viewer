{"ast":null,"code":"'use strict'; // s2.2.7.5/6/7\n\nvar STATUS = {\n  MORE: 0x0001,\n  ERROR: 0x0002,\n  // This bit is not yet in use by SQL Server, so is not exposed in the returned token\n  INXACT: 0x0004,\n  COUNT: 0x0010,\n  ATTN: 0x0020,\n  SRVERROR: 0x0100\n};\n\nfunction parseToken(parser, options, callback) {\n  parser.readUInt16LE(function (status) {\n    var more = !!(status & STATUS.MORE);\n    var sqlError = !!(status & STATUS.ERROR);\n    var rowCountValid = !!(status & STATUS.COUNT);\n    var attention = !!(status & STATUS.ATTN);\n    var serverError = !!(status & STATUS.SRVERROR);\n    parser.readUInt16LE(function (curCmd) {\n      (options.tdsVersion < '7_2' ? parser.readUInt32LE : parser.readUInt64LE).call(parser, function (rowCount) {\n        callback({\n          name: 'DONE',\n          event: 'done',\n          more: more,\n          sqlError: sqlError,\n          attention: attention,\n          serverError: serverError,\n          rowCount: rowCountValid ? rowCount : undefined,\n          curCmd: curCmd\n        });\n      });\n    });\n  });\n}\n\nmodule.exports.doneParser = doneParser;\n\nfunction doneParser(parser, colMetadata, options, callback) {\n  parseToken(parser, options, function (token) {\n    token.name = 'DONE';\n    token.event = 'done';\n    callback(token);\n  });\n}\n\nmodule.exports.doneInProcParser = doneInProcParser;\n\nfunction doneInProcParser(parser, colMetadata, options, callback) {\n  parseToken(parser, options, function (token) {\n    token.name = 'DONEINPROC';\n    token.event = 'doneInProc';\n    callback(token);\n  });\n}\n\nmodule.exports.doneProcParser = doneProcParser;\n\nfunction doneProcParser(parser, colMetadata, options, callback) {\n  parseToken(parser, options, function (token) {\n    token.name = 'DONEPROC';\n    token.event = 'doneProc';\n    callback(token);\n  });\n}","map":null,"metadata":{},"sourceType":"script"}